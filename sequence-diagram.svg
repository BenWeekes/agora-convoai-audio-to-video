<svg width="1400" height="1100" xmlns="http://www.w3.org/2000/svg">
  <!-- White background -->
  <rect width="1400" height="1100" fill="white"/>
  
  <!-- Title -->
  <text x="700" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="#333">
    Agora ConvoAI Audio-to-Video Integration Flow
  </text>
  
  <!-- Participants -->
  <g id="participants">
    <!-- Agora ConvoAI -->
    <rect x="80" y="80" width="150" height="50" rx="8" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
    <text x="155" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1976d2">Agora ConvoAI</text>
    
    <!-- Avatar Provider (Main) -->
    <rect x="350" y="80" width="180" height="50" rx="8" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
    <text x="440" y="100" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#7b1fa2">Avatar Provider</text>
    <text x="440" y="118" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#7b1fa2">(Main Domain)</text>
    
    <!-- Avatar Provider (WebSocket) -->
    <rect x="650" y="80" width="180" height="50" rx="8" fill="#e8f5e8" stroke="#388e3c" stroke-width="2"/>
    <text x="740" y="100" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#388e3c">Avatar Provider</text>
    <text x="740" y="118" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#388e3c">(WebSocket)</text>
    
    <!-- Agora Channel -->
    <rect x="950" y="80" width="150" height="50" rx="8" fill="#fff3e0" stroke="#f57c00" stroke-width="2"/>
    <text x="1025" y="110" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#f57c00">Agora Channel</text>
  </g>
  
  <!-- Vertical lifelines -->
  <g id="lifelines" stroke="#999" stroke-width="2" stroke-dasharray="5,5">
    <line x1="155" y1="130" x2="155" y2="1050"/>
    <line x1="440" y1="130" x2="440" y2="1050"/>
    <line x1="740" y1="130" x2="740" y2="1050"/>
    <line x1="1025" y1="130" x2="1025" y2="1050"/>
  </g>
  
  <!-- Phase 1: Initial Connection Setup -->
  <rect x="50" y="160" width="400" height="30" rx="5" fill="#fff9c4" stroke="#f9a825" stroke-width="2"/>
  <text x="250" y="180" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#f9a825">Initial Connection Setup</text>
  
  <!-- POST request -->
  <g id="post_request">
    <line x1="155" y1="210" x2="430" y2="210" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="290" y="205" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">POST /endpoint</text>
    <text x="165" y="225" font-family="Arial, sans-serif" font-size="10" fill="#666">{region, api_key, avatar_id,</text>
    <text x="165" y="240" font-family="Arial, sans-serif" font-size="10" fill="#666">agora_token, agora_uid, agora_channel}</text>
  </g>
  
  <!-- Response -->
  <g id="response">
    <line x1="430" y1="260" x2="165" y2="260" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" stroke-dasharray="4,4"/>
    <text x="295" y="255" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">Response</text>
    <text x="165" y="275" font-family="Arial, sans-serif" font-size="10" fill="#666">{session_id, websocket_address}</text>
  </g>
  
  <!-- Phase 2: WebSocket Connection -->
  <rect x="50" y="300" width="400" height="30" rx="5" fill="#fff9c4" stroke="#f9a825" stroke-width="2"/>
  <text x="250" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#f9a825">WebSocket Connection</text>
  
  <!-- WebSocket connect -->
  <g id="ws_connect">
    <line x1="155" y1="350" x2="730" y2="350" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="440" y="345" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">Connect to websocket_address</text>
    <text x="165" y="365" font-family="Arial, sans-serif" font-size="10" fill="#666">{session_id, avatar_id,</text>
    <text x="165" y="380" font-family="Arial, sans-serif" font-size="10" fill="#666">agora_token, agora_uid, agora_channel}</text>
  </g>
  
  <!-- Connection established -->
  <g id="connection_established">
    <line x1="730" y1="400" x2="165" y2="400" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" stroke-dasharray="4,4"/>
    <text x="445" y="395" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">Connection Established</text>
  </g>
  
  <!-- Phase 3: Avatar Publishing -->
  <rect x="650" y="430" width="400" height="30" rx="5" fill="#fff9c4" stroke="#f9a825" stroke-width="2"/>
  <text x="850" y="450" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#f9a825">Avatar Publishing</text>
  
  <!-- Publish avatar -->
  <g id="publish_avatar">
    <line x1="740" y1="480" x2="1015" y2="480" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="875" y="475" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">Publish Avatar Audio/Video</text>
    <text x="750" y="495" font-family="Arial, sans-serif" font-size="10" fill="#666">(via Golang SDK)</text>
  </g>
  
  <!-- Call metrics -->
  <g id="call_metrics">
    <line x1="1015" y1="520" x2="750" y2="520" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)" stroke-dasharray="4,4"/>
    <text x="880" y="515" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">Ongoing Call Metrics</text>
  </g>
  
  <!-- Phase 4: Ongoing Communication -->
  <rect x="50" y="550" width="1000" height="30" rx="5" fill="#fff9c4" stroke="#f9a825" stroke-width="2"/>
  <text x="550" y="570" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#f9a825">Ongoing Communication</text>
  
  <!-- Loop box -->
  <rect x="120" y="600" width="100" height="380" rx="5" fill="#f5f5f5" stroke="#999" stroke-width="2"/>
  <text x="130" y="620" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#666">Loop</text>
  
  <!-- Alt box -->
  <rect x="140" y="640" width="70" height="320" rx="5" fill="#e8f5e8" stroke="#4caf50" stroke-width="2"/>
  <text x="150" y="660" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#4caf50">alt</text>
  
  <!-- Voice Command -->
  <text x="240" y="690" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">[Voice Command]</text>
  <line x1="155" y1="710" x2="730" y2="710" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="240" y="730" font-family="Arial, sans-serif" font-size="10" fill="#666">{command: "voice",</text>
  <text x="240" y="745" font-family="Arial, sans-serif" font-size="10" fill="#666">audio: "base64_encoded_audio",</text>
  <text x="240" y="760" font-family="Arial, sans-serif" font-size="10" fill="#666">sampleRate: 24000,</text>
  <text x="240" y="775" font-family="Arial, sans-serif" font-size="10" fill="#666">encoding: "PCM16"}</text>
  
  <!-- State Command -->
  <text x="240" y="810" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">[State Command]</text>
  <line x1="155" y1="830" x2="730" y2="830" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="240" y="850" font-family="Arial, sans-serif" font-size="10" fill="#666">{command: "state", value: "listen" | "talk" | "idle"}</text>
  
  <!-- Special Command -->
  <text x="240" y="880" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">[Special Command]</text>
  <line x1="155" y1="900" x2="730" y2="900" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="240" y="920" font-family="Arial, sans-serif" font-size="10" fill="#666">{command: "special",</text>
  <text x="240" y="935" font-family="Arial, sans-serif" font-size="10" fill="#666">content: "XML markup for avatar gestures"}</text>
  
  <!-- Process command -->
  <rect x="740" y="950" width="170" height="50" rx="5" fill="#e3f2fd" stroke="#1976d2" stroke-width="1"/>
  <text x="825" y="970" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#1976d2">Process Command &</text>
  <text x="825" y="985" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#1976d2">Update Avatar</text>
  
  <!-- Update stream -->
  <line x1="740" y1="1020" x2="1015" y2="1020" stroke="#333" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="875" y="1015" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">Update Avatar</text>
  <text x="875" y="1040" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">Audio/Video Stream</text>
  
  <!-- Footer note -->
  <text x="700" y="1080" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#f9a825">Avatar states can switch between idle and listening based on commands</text>
  
  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="12" markerHeight="8" refX="11" refY="4" orient="auto">
      <polygon points="0 0, 12 4, 0 8" fill="#333"/>
    </marker>
  </defs>
</svg>
